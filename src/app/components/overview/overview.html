<div class="card">
  <p-toolbar>
    <div class="p-toolbar-group-start">
      <p-button 
        label="New Student" 
        icon="pi pi-plus" 
        styleClass="p-button-success"
        (click)="showAddDialog()">
      </p-button>
    </div>
  </p-toolbar>

  <p-table 
    [value]="students" 
    [paginator]="true" 
    [rows]="20" 
    styleClass="p-datatable-striped">
    <ng-template pTemplate="header">
      <tr>
        <th>Name</th>
        <th>Email</th>
        <th>Date of Birth</th>
        <th>Courses</th>
        <th>Actions</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-student>
      <tr>
        <td>{{ student.name }}</td>
        <td>{{ student.email }}</td>
        <td>{{ student.dob | date: 'longDate' }}</td>
        <td>{{ student.courses.join(', ') }}</td>
        <td>
          <p-button 
            icon="pi pi-pencil" 
            styleClass="p-button-info p-button-sm"
            (click)="showEditDialog(student)">
          </p-button>
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>

<!-- This dialog is for adding a new student -->
<p-dialog 
  header="Add New Student" 
  [(visible)]="displayAddDialog" 
  [modal]="true"
  [style]="{ width: '50vw' }"
  [draggable]="false"
  [resizable]="false">
  
  <app-student-form 
    (formSubmit)="onStudentAdded($event)"
    (formCancel)="displayAddDialog = false">
  </app-student-form>
</p-dialog>

<!-- --- THIS IS THE NEW DIALOG FOR EDITING --- -->
<p-dialog 
  header="Edit Student Courses" 
  [(visible)]="displayEditDialog" 
  [modal]="true"
  [style]="{ width: '50vw' }"
  [draggable]="false"
  [resizable]="false"
  (onHide)="selectedStudent = null"> <!-- Resets the selected student when the dialog is closed -->
  
  <!-- We reuse the same form, passing in the student to be edited -->
  <app-student-form *ngIf="selectedStudent"
    [student]="selectedStudent"
    (formSubmit)="onStudentUpdated($event)"
    (formCancel)="displayEditDialog = false">
  </app-student-form>
</p-dialog>